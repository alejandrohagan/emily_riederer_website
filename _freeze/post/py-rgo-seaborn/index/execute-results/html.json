{
  "hash": "17d351b78c9d4299ce07ca6241a6e9df",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"`seaborn`' Rgonomic Patterns\"\ndescription: \"`ggplot2`'s excellence and impact on data visualization is undeniable. In this continuation of the Python Rgonomics series, we look at the recently released `seaborn` objects interface. This transports the best of `ggplot2`'s design philosophy into a one of the most common python visualization libraries while integrating seamlessly with `matplotlib`\"\nauthor: \"Emily Riederer\"\ndate: \"2024-01-20\"\ncategories: [rstats, python, tutorial]\nimage: \"featured.jpg\"\ndraft: true\n---\n\n![ Image credit to [`seaborn` documentation](https://seaborn.pydata.org/examples/wide_data_lineplot.html)](featured.jpg)\n\nRecently, I've written about python tools and packages that have [the most similar ergonomics](https://www.emilyriederer.com/post/py-rgo/) to what R users might expect. This post continues that general overview and [`polars` deep dive](https://www.emilyriederer.com/post/py-rgo-polars/) with a focus on the visualization layer.\n\nEven R's most ardent critics often have to admit that `ggplot2` is a thing of beauty. It's approach to encoding graphical choices has influenced countless packges in other languages. [In September 2022](https://seaborn.pydata.org/whatsnew/v0.12.0.html#introduction-of-the-objects-interface), python's highly popular `seaborn` package joined the club by introducing it's [objects interface](https://seaborn.pydata.org/tutorial.html#objects-interface) which describes itself as:\n\n> The interface aims to provide a more declarative, composable, and extensible API for making statistical graphics. It is inspired by Wilkinson’s grammar of graphics, offering a Pythonic API that is informed by the design of libraries such as `ggplot2` and `vega-lite` along with lessons from the past 10 years of `seaborn`’s development.\n\n`seaborn.objects`, then, seems a \"best of both worlds\": a truly pythonic approach^[Unlike other options like `plotnine` which may offer a much closer parallel to `ggplot2` but feel like more of an island than an on-ramp to the python ecosystem] that should easily extend and integrate with python-native workflows while introducing the usability and intuition of `ggplot2`. \n\nThis post explores the extent to which that promise holds true and how well `seaborn.objects` captures the ergonomics of `ggplot2`. Beyond similarities to `ggplot2`, we'll see how `seaborn.objects` can be an on ramp for `matplotlib` to mirror more advanced R plotting capabilities like `patchwork`'s ability to compose multiple plots into figures. \n\n::: {.callout-warning}\nAs-of writing, `seaborn.objects` is still [flagged as experimental](https://seaborn.pydata.org/tutorial/objects_interface.html) in the documentation. \n:::\n\n## What are `ggplot2`'s ergonomics?\n\nTo claim that `seaborn.objects` has a similar aesthetic and user experience as `ggplot2`, we can consider what has given `ggplot2` such staying power. Fortunately, the underlying philosophy of the grammar of graphics is well explored, including in Hadley Wickham's [paper](https://vita.had.co.nz/papers/layered-grammar.html) and the [`ggplot2` book](https://ggplot2-book.org/introduction) (currently a work-in-progress 3rd edition). Key features include:\n\n- \"An underlying *grammar* that allows you to compose graphs by combining independent components\"\n- A *layered* approach to constructing that grammar that supports composable, iterative development\n- A rich set of capabilities to control each set of components (layers, scales, coordinate systems, facets, themes, labels) with reasonable defaults should you chose not to\n\nWhile these two features may seem esoteric, what they afford a sweet-spot level of abstraction. Unlike a `d3` or `matplotlib`, users do not need to articulate specifically *how* a plot should be built; however, they remain in control of any aspect they want to control, unlike many BI tools or the original `seaborn` set of preconfigured plot options (e.g. separate cookiecutter functions for `boxplot`, `barplot`, `swarmplot`, etc. which limits flexibility and increases the surface area of what must be learned). \n\nSo, with that, we will import `seaborn.objects` and get started!\n\n::: {#c3e8bc7f .cell execution_count=1}\n``` {.python .cell-code}\nimport seaborn as sns\nimport seaborn.objects as so\n```\n:::\n\n\nThis document was made with `seaborn` version `0.13.1`.\n\n## But first - data \n\nTODO: How much of this is needed?\n\nTo illustrate `seaborn.objects`, we'll use the NYC taxi data provided by `seaborn`, along with `polars` (which I [discussed recently](/post/py-rgo-polars/)). \n\n::: {#3690b467 .cell execution_count=2}\n``` {.python .cell-code}\nimport polars as pl \nimport polars.selectors as cs\n\ndf_pd = sns.load_dataset('taxis')\ndf = pl.from_pandas(df_pd)\ndf.glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6433\nColumns: 14\n$ pickup          <datetime[ns]> 2019-03-23 20:21:09, 2019-03-04 16:11:55, 2019-03-27 17:53:01, 2019-03-10 01:23:59, 2019-03-30 13:27:42, 2019-03-11 10:37:23, 2019-03-26 21:07:31, 2019-03-22 12:47:13, 2019-03-23 11:48:50, 2019-03-08 16:18:37\n$ dropoff         <datetime[ns]> 2019-03-23 20:27:24, 2019-03-04 16:19:00, 2019-03-27 18:00:25, 2019-03-10 01:49:51, 2019-03-30 13:37:14, 2019-03-11 10:47:31, 2019-03-26 21:17:29, 2019-03-22 12:58:17, 2019-03-23 12:06:14, 2019-03-08 16:26:57\n$ passengers               <i64> 1, 1, 1, 1, 3, 1, 1, 0, 1, 1\n$ distance                 <f64> 1.6, 0.79, 1.37, 7.7, 2.16, 0.49, 3.65, 1.4, 3.63, 1.52\n$ fare                     <f64> 7.0, 5.0, 7.5, 27.0, 9.0, 7.5, 13.0, 8.5, 15.0, 8.0\n$ tip                      <f64> 2.15, 0.0, 2.36, 6.15, 1.1, 2.16, 2.0, 0.0, 1.0, 1.0\n$ tolls                    <f64> 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0\n$ total                    <f64> 12.95, 9.3, 14.16, 36.95, 13.4, 12.96, 18.8, 11.8, 19.3, 13.3\n$ color                    <str> 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow'\n$ payment                  <str> 'credit card', 'cash', 'credit card', 'credit card', 'credit card', 'credit card', 'credit card', None, 'credit card', 'credit card'\n$ pickup_zone              <str> 'Lenox Hill West', 'Upper West Side South', 'Alphabet City', 'Hudson Sq', 'Midtown East', 'Times Sq/Theatre District', 'Battery Park City', 'Murray Hill', 'East Harlem South', 'Lincoln Square East'\n$ dropoff_zone             <str> 'UN/Turtle Bay South', 'Upper West Side South', 'West Village', 'Yorkville West', 'Yorkville West', 'Midtown East', 'Two Bridges/Seward Park', 'Flatiron', 'Midtown Center', 'Central Park'\n$ pickup_borough           <str> 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan'\n$ dropoff_borough          <str> 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan'\n\n```\n:::\n:::\n\n\n::: {#1f838d64 .cell execution_count=3}\n``` {.python .cell-code}\ndf_trips = (\n    df\n    .filter( pl.col('pickup_borough') == pl.col('dropoff_borough') )\n    .with_columns(\n        #date = pl.col('pickup').cast(pl.Date),\n        dow = pl.col('pickup').dt.weekday(),\n        hod = pl.col('pickup').dt.hour(),\n        dur = (pl.col('dropoff') - pl.col('pickup')).dt.total_minutes()\n    )\n    .with_columns( \n        #cs.by_name('pickup','dropoff').cast(pl.Date).prefix('dt_'),\n        wnd = pl.when( pl.col('dow') > 5).then(pl.lit('Yes')).otherwise(pl.lit('No'))\n        )\n)\n\ndf_trips.glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5582\nColumns: 18\n$ pickup          <datetime[ns]> 2019-03-23 20:21:09, 2019-03-04 16:11:55, 2019-03-27 17:53:01, 2019-03-10 01:23:59, 2019-03-30 13:27:42, 2019-03-11 10:37:23, 2019-03-26 21:07:31, 2019-03-22 12:47:13, 2019-03-23 11:48:50, 2019-03-08 16:18:37\n$ dropoff         <datetime[ns]> 2019-03-23 20:27:24, 2019-03-04 16:19:00, 2019-03-27 18:00:25, 2019-03-10 01:49:51, 2019-03-30 13:37:14, 2019-03-11 10:47:31, 2019-03-26 21:17:29, 2019-03-22 12:58:17, 2019-03-23 12:06:14, 2019-03-08 16:26:57\n$ passengers               <i64> 1, 1, 1, 1, 3, 1, 1, 0, 1, 1\n$ distance                 <f64> 1.6, 0.79, 1.37, 7.7, 2.16, 0.49, 3.65, 1.4, 3.63, 1.52\n$ fare                     <f64> 7.0, 5.0, 7.5, 27.0, 9.0, 7.5, 13.0, 8.5, 15.0, 8.0\n$ tip                      <f64> 2.15, 0.0, 2.36, 6.15, 1.1, 2.16, 2.0, 0.0, 1.0, 1.0\n$ tolls                    <f64> 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0\n$ total                    <f64> 12.95, 9.3, 14.16, 36.95, 13.4, 12.96, 18.8, 11.8, 19.3, 13.3\n$ color                    <str> 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow', 'yellow'\n$ payment                  <str> 'credit card', 'cash', 'credit card', 'credit card', 'credit card', 'credit card', 'credit card', None, 'credit card', 'credit card'\n$ pickup_zone              <str> 'Lenox Hill West', 'Upper West Side South', 'Alphabet City', 'Hudson Sq', 'Midtown East', 'Times Sq/Theatre District', 'Battery Park City', 'Murray Hill', 'East Harlem South', 'Lincoln Square East'\n$ dropoff_zone             <str> 'UN/Turtle Bay South', 'Upper West Side South', 'West Village', 'Yorkville West', 'Yorkville West', 'Midtown East', 'Two Bridges/Seward Park', 'Flatiron', 'Midtown Center', 'Central Park'\n$ pickup_borough           <str> 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan'\n$ dropoff_borough          <str> 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan', 'Manhattan'\n$ dow                       <i8> 6, 1, 3, 7, 6, 1, 2, 5, 6, 5\n$ hod                       <i8> 20, 16, 17, 1, 13, 10, 21, 12, 11, 16\n$ dur                      <i64> 6, 7, 7, 25, 9, 10, 9, 11, 17, 8\n$ wnd                      <str> 'Yes', 'No', 'No', 'Yes', 'Yes', 'No', 'No', 'No', 'Yes', 'No'\n\n```\n:::\n:::\n\n\n## Basics\n\nJust like in `ggplot2`, `seaborn.objects` allows us to build up a plot slowly and incrementally. \n\nWe can start by simply defining a layer with our basic axes - just as we would with a call to `ggplot()`.\n\n::: {#7036e95c .cell execution_count=4}\n``` {.python .cell-code}\n(\n  so.Plot(df_trips)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n![](index_files/figure-html/cell-5-output-1.png){width=599 height=445}\n:::\n:::\n\n\nThe next order of business is to think about the variables of interest in our dataset and how they should be mapped to visual properties. `ggplot2` considers these *aesthetic* properties and wraps them in `aes()`; in `seaborn.objects`, we can insert them directly into `Plot()`.\n\n::: {#0438a978 .cell execution_count=5}\n``` {.python .cell-code}\n(\n  so.Plot(df_trips, x = 'distance', y = 'dur')\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n![](index_files/figure-html/cell-6-output-1.png){width=599 height=445}\n:::\n:::\n\n\nTo visually encode data onto our plot, we next need to consider what geometric objects are best suited to represent the data. In a `ggplot2` workflow, we'd next add a `geom_{type}` layer; here, we call the `.add()` method and pass the corresponding `so.{Type}` as the first argument. \n\n::: {#44088b4c .cell execution_count=6}\n``` {.python .cell-code}\n(\n  so.Plot(df_trips, x = 'distance', y = 'dur')\n  .add(so.Dot(alpha = 0.2))\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n![](index_files/figure-html/cell-7-output-1.png){width=599 height=445}\n:::\n:::\n\n\nBy now I've hopefully convinced you that `seaborn.objects` really does layer! So, I'll jump ahead a few steps.\n\n::: {#cacfe16e .cell execution_count=7}\n``` {.python .cell-code}\np = (\n  so.Plot(df_trips, x = 'distance', y = 'dur')\n  .add(so.Dot(alpha = 0.2), marker = 'wnd', color = 'hod')\n  .facet(col = 'pickup_borough',\n         order = ['Manhattan', 'Brooklyn', 'Queens', 'Bronx'],\n         wrap = 2)\n)\n\np\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n![](index_files/figure-html/cell-8-output-1.png){width=688 height=445}\n:::\n:::\n\n\nAmong the features you'll notice in the above is the facetting. In fact, here `seaborn` has one nice benefit above `ggplot2`. In R, if we want to plot multiple variables in different facets, we need to pivot them into a hyper-long data format^[Essentially, we make the variable names themselves into a column]. Instead in `seaborn.objects`, we can provide multiple `x` or `y` arguments with the `pairs()` method.\n\n::: {#c90e9543 .cell execution_count=8}\n``` {.python .cell-code}\n(\n  so.Plot(df_trips, x = 'distance')\n  .pair(y = ['dur','fare'])\n  .add(so.Dot(alpha = 0.2), color = 'wnd')\n  .label(x = 'Distance (Mi)', \n        y0 = 'Duration (Min)', \n        y1 = 'Fare ($)',\n        color = \"Weekend?\")\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n![](index_files/figure-html/cell-9-output-1.png){width=699 height=445}\n:::\n:::\n\n\n## Polishing\n\nBeyond the core grammar of graphics, `seaborn.objects` provides analogous functionality to `ggplot2` for fine-tuning aesthetics with scales, themes, and labels. Both can be defined as python dictionaries^[Dictionaries are roughly analogous to named lists in R.]\n\nLabels actually work *precisely* as in R and could be passed in directly versus being definied in a separate dictionary. However, for readability, I tend to prefer defining them in a dictionary like with the theme, and then using the `**` to unpack them. \n\n::: {#48bfa884 .cell execution_count=9}\n``` {.python .cell-code}\ntheme_spec = {\n  \"axes.facecolor\": \"w\", \n  \"axes.edgecolor\": \"slategray\"\n}\n\nlabel_spec = {\n  'x': \"Distance (mi)\",\n  'y': \"Trip Time (min)\",\n  'color': \"Weekend?\"\n}\n\np = (\n  p\n  .scale(color = \"crest\")\n  .theme(theme_spec)\n  .label(**label_spec)\n)\n\np.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-10-output-1.png){}\n:::\n:::\n\n\n## Going further with `matplotlib`\n\n### Titles\n\n::: {#cf42ba6c .cell execution_count=10}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\nf = plt.figure()\nf.suptitle(\"AAA\")\np.on(f).plot()\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n![](index_files/figure-html/cell-11-output-1.png){width=738 height=483}\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-11-output-2.png){width=747 height=484}\n:::\n:::\n\n\n### Subfigures \n\nhttps://seaborn.pydata.org/generated/seaborn.objects.Plot.on.html\n\n::: {#350238b5 .cell execution_count=11}\n``` {.python .cell-code}\nimport matplotlib as mpl\nf = mpl.figure.Figure(figsize=(7, 4), dpi=100, layout=\"constrained\")\nsf1, sf2 = f.subfigures(1, 2)\n\nf.suptitle(\"AAA\")\np.on(sf1).plot()\np.on(sf2).plot()\nf\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n![](index_files/figure-html/cell-12-output-1.png){}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}