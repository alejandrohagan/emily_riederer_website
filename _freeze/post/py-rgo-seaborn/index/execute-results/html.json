{
  "hash": "79546e3d678f9c462ba6513619db3d4b",
  "result": {
    "markdown": "---\ntitle: \"`seaborn`' Rgonomic Patterns\"\ndescription: \"`ggplot2`'s excellence and impact on data visualization is undeniable. In this continuation of the Python Rgonomics series, we look at the recently released `seaborn` objects interface. This transports the best of `ggplot2`'s grammar-of-graphics design philosophy into a one of the most common python visualization libraries, creating the perfect on-ramp for users of both languages\"\nauthor: \"Emily Riederer\"\ndate: \"2024-01-20\"\ncategories: [rstats, python, tutorial]\nimage: \"featured.jpg\"\ndraft: true\n---\n\n![ Image credit to [`seaborn` documentation](https://seaborn.pydata.org/examples/wide_data_lineplot.html)](featured.jpg)\n\nRecently, I've written about python tools and packages that have [the most similar ergonomics](https://www.emilyriederer.com/post/py-rgo/) to what R users might expect. This post continues that general overview and [`polars` deep dive](https://www.emilyriederer.com/post/py-rgo-polars/) with a focus on the visualization layer.\n\nEven R's most ardent critics often have to admit that `ggplot2` is a thing of beauty. It's approach to encoding graphical choices has influenced countless packges in other languages. [In September 2022](https://seaborn.pydata.org/whatsnew/v0.12.0.html#introduction-of-the-objects-interface), python's highly popular `seaborn` package joined the club by introducing it's [objects interface](https://seaborn.pydata.org/tutorial.html#objects-interface) which describes itself as:\n\n> The interface aims to provide a more declarative, composable, and extensible API for making statistical graphics. It is inspired by Wilkinson’s grammar of graphics, offering a Pythonic API that is informed by the design of libraries such as `ggplot2` and `vega-lite` along with lessons from the past 10 years of `seaborn`’s development.\n\n`seaborn.objects`, then, seems to promise a \"best of both worlds\": a truly pythonic approach^[Unlike other options like `plotnine` which may offer a much closer parallel to `ggplot2` but feel like more of an island than an on-ramp to the python ecosystem] that should easily extend and integrate with python-native workflows while introducing the usability and intuition of `ggplot2`. This post explores the extent to which that promise holds true and how well `seaborn.objects` captures the ergonomics of `ggplot2`.\n\n::: {.callout-warning}\nAs-of writing, `seaborn.objects` is still [flagged as experimental](https://seaborn.pydata.org/tutorial/objects_interface.html) in the documentation. \n:::\n\n## What are `ggplot2`'s ergonomics?\n\nTo claim that `seaborn.objects` has a similar aesthetic and user experience as `ggplot2`, we can consider what has given `ggplot2` such staying power. Fortunately, the underlying philosophy of the grammar of graphics is well explored, including in Hadley Wickham's [paper](https://vita.had.co.nz/papers/layered-grammar.html) and the [`ggplot2` book](https://ggplot2-book.org/introduction) (currently a work-in-progress 3rd edition). Key features include:\n\n- \"An underlying *grammar* that allows you to compose graphs by combining independent components\"\n- A *layered* approach to constructing that grammar that supports composable, iterative development\n- A rich set of capabilities to control each set of components (layers, scales, coordinate systems, facets, themes, labels) with reasonable defaults should you chose not to\n\nWhile these two features may seem esoteric, what they afford a sweet-spot level of abstraction. Unlike a `d3` or `matplotlib`, users do not need to articulate specifically *how* a plot should be built; however, they remain in control of any aspect they want to control, unlike many BI tools or the original `seaborn` set of preconfigured plot options (e.g. separate cookiecutter functions for `boxplot`, `barplot`, `swarmplot`, etc. which limits flexibility and increases the surface area of what must be learned). \n\nSo, with that, we will import `seaborn.objects` and get started!\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport seaborn as sns\nimport seaborn.objects as so\n```\n:::\n\n\nThis document was made with `seaborn` version `0.13.1`.\n\n## But first - data \n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nimport polars as pl \nimport polars.selectors as cs\n\ndf_pd = sns.load_dataset('taxis')\ndf = pl.from_pandas(df_pd)\ndf.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 14)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>pickup</th><th>dropoff</th><th>passengers</th><th>distance</th><th>fare</th><th>tip</th><th>tolls</th><th>total</th><th>color</th><th>payment</th><th>pickup_zone</th><th>dropoff_zone</th><th>pickup_borough</th><th>dropoff_borough</th></tr><tr><td>datetime[ns]</td><td>datetime[ns]</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>str</td><td>str</td><td>str</td><td>str</td><td>str</td><td>str</td></tr></thead><tbody><tr><td>2019-03-23 20:21:09</td><td>2019-03-23 20:27:24</td><td>1</td><td>1.6</td><td>7.0</td><td>2.15</td><td>0.0</td><td>12.95</td><td>&quot;yellow&quot;</td><td>&quot;credit card&quot;</td><td>&quot;Lenox Hill Wes…</td><td>&quot;UN/Turtle Bay …</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td></tr><tr><td>2019-03-04 16:11:55</td><td>2019-03-04 16:19:00</td><td>1</td><td>0.79</td><td>5.0</td><td>0.0</td><td>0.0</td><td>9.3</td><td>&quot;yellow&quot;</td><td>&quot;cash&quot;</td><td>&quot;Upper West Sid…</td><td>&quot;Upper West Sid…</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td></tr><tr><td>2019-03-27 17:53:01</td><td>2019-03-27 18:00:25</td><td>1</td><td>1.37</td><td>7.5</td><td>2.36</td><td>0.0</td><td>14.16</td><td>&quot;yellow&quot;</td><td>&quot;credit card&quot;</td><td>&quot;Alphabet City&quot;</td><td>&quot;West Village&quot;</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td></tr><tr><td>2019-03-10 01:23:59</td><td>2019-03-10 01:49:51</td><td>1</td><td>7.7</td><td>27.0</td><td>6.15</td><td>0.0</td><td>36.95</td><td>&quot;yellow&quot;</td><td>&quot;credit card&quot;</td><td>&quot;Hudson Sq&quot;</td><td>&quot;Yorkville West…</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td></tr><tr><td>2019-03-30 13:27:42</td><td>2019-03-30 13:37:14</td><td>3</td><td>2.16</td><td>9.0</td><td>1.1</td><td>0.0</td><td>13.4</td><td>&quot;yellow&quot;</td><td>&quot;credit card&quot;</td><td>&quot;Midtown East&quot;</td><td>&quot;Yorkville West…</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ndf_trips = (\n    df\n    .with_columns(\n        date = pl.col('pickup').cast(pl.Date),\n        dow = pl.col('pickup').dt.weekday(),\n        hod = pl.col('pickup').dt.hour(),\n        duration = (pl.col('dropoff') - pl.col('pickup')).dt.minutes()\n    )\n    .with_columns( \n        cs.by_name('pickup','dropoff').cast(pl.Date).prefix('dt_'),\n        wnd = pl.when( pl.col('dow') > 5).then(True).otherwise(False)\n        )\n)\n\ndf_trips.head()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nC:\\Users\\emily\\AppData\\Local\\Temp\\ipykernel_17628\\3217665268.py:7: DeprecationWarning: `minutes` is deprecated. It has been renamed to `total_minutes`.\n  duration = (pl.col('dropoff') - pl.col('pickup')).dt.minutes()\nC:\\Users\\emily\\AppData\\Local\\Temp\\ipykernel_17628\\3217665268.py:10: DeprecationWarning: `prefix` is deprecated. It has been moved to `name.prefix`.\n  cs.by_name('pickup','dropoff').cast(pl.Date).prefix('dt_'),\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 21)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>pickup</th><th>dropoff</th><th>passengers</th><th>distance</th><th>fare</th><th>tip</th><th>tolls</th><th>total</th><th>color</th><th>payment</th><th>pickup_zone</th><th>dropoff_zone</th><th>pickup_borough</th><th>dropoff_borough</th><th>date</th><th>dow</th><th>hod</th><th>duration</th><th>dt_pickup</th><th>dt_dropoff</th><th>wnd</th></tr><tr><td>datetime[ns]</td><td>datetime[ns]</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>str</td><td>str</td><td>str</td><td>str</td><td>str</td><td>str</td><td>date</td><td>i8</td><td>i8</td><td>i64</td><td>date</td><td>date</td><td>bool</td></tr></thead><tbody><tr><td>2019-03-23 20:21:09</td><td>2019-03-23 20:27:24</td><td>1</td><td>1.6</td><td>7.0</td><td>2.15</td><td>0.0</td><td>12.95</td><td>&quot;yellow&quot;</td><td>&quot;credit card&quot;</td><td>&quot;Lenox Hill Wes…</td><td>&quot;UN/Turtle Bay …</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td><td>2019-03-23</td><td>6</td><td>20</td><td>6</td><td>2019-03-23</td><td>2019-03-23</td><td>true</td></tr><tr><td>2019-03-04 16:11:55</td><td>2019-03-04 16:19:00</td><td>1</td><td>0.79</td><td>5.0</td><td>0.0</td><td>0.0</td><td>9.3</td><td>&quot;yellow&quot;</td><td>&quot;cash&quot;</td><td>&quot;Upper West Sid…</td><td>&quot;Upper West Sid…</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td><td>2019-03-04</td><td>1</td><td>16</td><td>7</td><td>2019-03-04</td><td>2019-03-04</td><td>false</td></tr><tr><td>2019-03-27 17:53:01</td><td>2019-03-27 18:00:25</td><td>1</td><td>1.37</td><td>7.5</td><td>2.36</td><td>0.0</td><td>14.16</td><td>&quot;yellow&quot;</td><td>&quot;credit card&quot;</td><td>&quot;Alphabet City&quot;</td><td>&quot;West Village&quot;</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td><td>2019-03-27</td><td>3</td><td>17</td><td>7</td><td>2019-03-27</td><td>2019-03-27</td><td>false</td></tr><tr><td>2019-03-10 01:23:59</td><td>2019-03-10 01:49:51</td><td>1</td><td>7.7</td><td>27.0</td><td>6.15</td><td>0.0</td><td>36.95</td><td>&quot;yellow&quot;</td><td>&quot;credit card&quot;</td><td>&quot;Hudson Sq&quot;</td><td>&quot;Yorkville West…</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td><td>2019-03-10</td><td>7</td><td>1</td><td>25</td><td>2019-03-10</td><td>2019-03-10</td><td>true</td></tr><tr><td>2019-03-30 13:27:42</td><td>2019-03-30 13:37:14</td><td>3</td><td>2.16</td><td>9.0</td><td>1.1</td><td>0.0</td><td>13.4</td><td>&quot;yellow&quot;</td><td>&quot;credit card&quot;</td><td>&quot;Midtown East&quot;</td><td>&quot;Yorkville West…</td><td>&quot;Manhattan&quot;</td><td>&quot;Manhattan&quot;</td><td>2019-03-30</td><td>6</td><td>13</td><td>9</td><td>2019-03-30</td><td>2019-03-30</td><td>true</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Plots\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\n(\n  so.Plot(df_trips, x = 'distance', y = 'fare')\n  .add(so.Dot(alpha = 0.2))\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n![](index_files/figure-html/cell-5-output-1.png){width=599 height=445}\n:::\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\n(\n  so.Plot(df_trips, x = 'distance', y = 'duration', color = 'wnd')\n  .add(so.Dot(alpha = 0.2))\n  .facet(col = 'pickup_borough', wrap = 2)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n![](index_files/figure-html/cell-6-output-1.png){width=700 height=445}\n:::\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\n(\n  so.Plot(df_trips, x = 'distance', y = 'duration', color = 'wnd')\n  .add(so.Dot(alpha = 0.2))\n  .facet(col = 'pickup_borough', \n         order = ['Manhattan', 'Brooklyn', 'Queens', 'Bronx'],\n         wrap = 2)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n![](index_files/figure-html/cell-7-output-1.png){width=700 height=445}\n:::\n:::\n\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\ntheme_spec = {\n  \"axes.facecolor\": \"w\", \n  \"axes.edgecolor\": \"slategray\"\n}\n\nlabel_spec = {\n    'x': \"Distance (mi)\",\n    'y': \"Trip Time (min)\",\n    'color': \"Day or Week\"\n}\n\np = (\n  so.Plot(df_trips, x = 'distance', y = 'duration', color = 'wnd')\n  .add(so.Dot(alpha = 0.2))\n  .facet(col = 'pickup_borough', \n         order = ['Manhattan', 'Brooklyn', 'Queens', 'Bronx'],\n         wrap = 2)\n  .scale(color = \"viridis\")\n  .theme(theme_spec)\n  .label(**label_spec)\n)\n\np.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-8-output-1.png){}\n:::\n:::\n\n\n## Convert to Matplotlib for Deeper Dive\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\nf = plt.figure()\nf.suptitle(\"AAA\")\np.on(f).plot()\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n![](index_files/figure-html/cell-9-output-1.png){width=762 height=483}\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-9-output-2.png){width=776 height=484}\n:::\n:::\n\n\n## Subfigures \n\nhttps://seaborn.pydata.org/generated/seaborn.objects.Plot.on.html\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\nimport matplotlib as mpl\nf = mpl.figure.Figure(figsize=(7, 4), dpi=100, layout=\"constrained\")\nsf1, sf2 = f.subfigures(1, 2)\n\nf.suptitle(\"AAA\")\np.on(sf1).plot()\np.on(sf2).plot()\nf\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n![](index_files/figure-html/cell-10-output-1.png){}\n:::\n:::\n\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\nf\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n![](index_files/figure-html/cell-11-output-1.png){}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}